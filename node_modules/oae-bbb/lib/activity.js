var _ = require('underscore');

var ActivityAPI = require('oae-activity');
var ActivityConstants = require('oae-activity/lib/constants').ActivityConstants;
var ActivityModel = require('oae-activity/lib/model');
var ActivityUtil = require('oae-activity/lib/util');


var MeetingAPI = require('./api');
var MeetingConstants = require('./constants').MeetingConstants;

ActivityAPI.registerActivityType(MeetingConstants.activity.ACTIVITY_MEETING_CREATE, {
    'groupBy': [{'actor': true}],
    'streams': {
        'activity': {
            'router': {
                'actor': ['self', 'followers'],
                'object': ['self', 'members']
            }
        },
        'notification': {
            'router': {
                'object': ['members']
            }
        }
    }
});


MeetingAPI.on(MeetingConstants.events.CREATED_MEETING, function(ctx, meeting, members) {
	console.log("en activity.js");
    var millis = Date.now();
    var actorResource = new ActivityModel.ActivitySeedResource('user', ctx.user().id, {'user': ctx.user()});
    var objectResource = new ActivityModel.ActivitySeedResource('meeting', meeting.id, {'meeting': meeting});
    var activitySeed = new ActivityModel.ActivitySeed(MeetingConstants.activity.ACTIVITY_MEETING_CREATE, millis, ActivityConstants.verbs.CREATE, actorResource, objectResource);
    	console.log(activitySeed);
	ActivityAPI.postActivity(ctx, activitySeed);
});
